<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>E-Store Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
      [x-cloak] {
        display: none !important;
      }
      .page-transition {
        animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      body {
        background: #f5f5f5;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div x-data="app()" x-cloak>
      <!-- Navigation -->
      <nav class="bg-white shadow-md sticky top-0 z-50" x-show="user">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex flex-col sm:flex-row sm:justify-between sm:h-16">
            <div class="flex items-center justify-center sm:justify-start py-3 sm:py-0">
              <button
                @click="navigateTo('home')"
                class="text-xl sm:text-2xl font-bold text-gray-900 hover:text-gray-700 transition"
              >
                üõí E-Store Panel
              </button>
            </div>
            <div class="flex items-center justify-center flex-wrap gap-2 sm:gap-3 pb-3 sm:pb-0">
              <button
                @click="navigateTo('home')"
                :class="page === 'home' ? 'bg-gray-900 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                class="px-3 sm:px-4 py-2 rounded-xl transition font-medium text-sm sm:text-base"
              >
                <span class="hidden sm:inline">üè™ –¢–æ–≤–∞—Ä—ã</span>
                <span class="sm:hidden">üè™</span>
              </button>
              <button
                @click="navigateTo('cart')"
                :class="page === 'cart' ? 'bg-gray-900 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                class="relative px-3 sm:px-4 py-2 rounded-xl transition font-medium text-sm sm:text-base"
              >
                <span class="hidden sm:inline">üõí –ö–æ—Ä–∑–∏–Ω–∞</span>
                <span class="sm:hidden">üõí</span>
                <span
                  x-show="cart.items && cart.items.length > 0"
                  x-text="cart.items.length"
                  class="absolute -top-1 -right-1 bg-black text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold"
                ></span>
              </button>
              <button
                @click="navigateTo('orders')"
                :class="page === 'orders' ? 'bg-gray-900 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                class="px-3 sm:px-4 py-2 rounded-xl transition font-medium text-sm sm:text-base"
              >
                <span class="hidden sm:inline">üì¶ –ó–∞–∫–∞–∑—ã</span>
                <span class="sm:hidden">üì¶</span>
              </button>
              <button
                @click="navigateTo('profile')"
                :class="page === 'profile' ? 'bg-gray-900 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                class="px-3 sm:px-4 py-2 rounded-xl transition font-medium text-sm sm:text-base"
              >
                üë§ <span class="hidden sm:inline" x-text="user.name"></span>
              </button>
              <template x-if="user.role === 'ADMIN'">
                <button
                  @click="navigateTo('admin')"
                  :class="page === 'admin' ? 'bg-gray-900 text-white' : 'bg-gray-700 text-white hover:bg-gray-800'"
                  class="px-3 sm:px-4 py-2 rounded-xl transition font-medium text-sm sm:text-base"
                >
                  <span class="hidden sm:inline">‚öôÔ∏è –ê–¥–º–∏–Ω</span>
                  <span class="sm:hidden">‚öôÔ∏è</span>
                </button>
              </template>
              <button
                @click="logout()"
                class="px-3 sm:px-4 py-2 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition font-medium text-sm sm:text-base"
              >
                <span class="hidden sm:inline">–í—ã—Ö–æ–¥</span>
                <span class="sm:hidden">‚Ü©</span>
              </button>
            </div>
          </div>
        </div>
      </nav>

      <!-- Main Content -->
      <div class="w-full">
        <!-- Alert -->
        <div x-show="alert.show" class="mb-6 page-transition max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div
            :class="alert.type === 'success' ? 'bg-gray-100 border-gray-900 text-gray-900' : 'bg-gray-200 border-gray-700 text-gray-900'"
            class="border-l-4 px-6 py-4 rounded-2xl shadow-lg relative"
          >
            <span class="font-medium" x-text="alert.message"></span>
            <button @click="alert.show = false" class="absolute top-3 right-4 text-2xl opacity-50 hover:opacity-100 transition">
              &times;
            </button>
          </div>
        </div>

        <!-- Content wrapper with max-width and centering -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- Welcome/Landing Page for non-authenticated users -->
        <template x-if="!user && page === 'home'">
          <div class="page-transition flex items-center justify-center py-12">
            <div class="bg-white rounded-3xl shadow-2xl p-8 sm:p-12 w-full max-w-2xl border border-gray-200">
              <div class="text-center mb-8 sm:mb-10">
                <div class="text-5xl sm:text-6xl mb-4 sm:mb-6">üõí</div>
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900 mb-3 sm:mb-4">E-Store Panel</h1>
                <p class="text-lg sm:text-xl text-gray-600">–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ–Ω–ª–∞–π–Ω-–ø–æ–∫—É–ø–æ–∫</p>
              </div>
              <div class="grid grid-cols-3 gap-4 sm:gap-6 mb-8 sm:mb-10">
                <div class="text-center p-3 sm:p-4">
                  <div class="text-2xl sm:text-3xl mb-2">‚ö°</div>
                  <p class="text-sm sm:text-base text-gray-700 font-medium">–ë—ã—Å—Ç—Ä–æ</p>
                </div>
                <div class="text-center p-3 sm:p-4">
                  <div class="text-2xl sm:text-3xl mb-2">üîí</div>
                  <p class="text-sm sm:text-base text-gray-700 font-medium">–ë–µ–∑–æ–ø–∞—Å–Ω–æ</p>
                </div>
                <div class="text-center p-3 sm:p-4">
                  <div class="text-2xl sm:text-3xl mb-2">üíé</div>
                  <p class="text-sm sm:text-base text-gray-700 font-medium">–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ</p>
                </div>
              </div>
              <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
                <button
                  @click="navigateTo('login')"
                  class="flex-1 px-6 sm:px-8 py-3 sm:py-4 bg-gray-900 text-white rounded-2xl hover:bg-gray-800 transition font-semibold shadow-lg hover:shadow-xl text-base sm:text-lg"
                >
                  –í–æ–π—Ç–∏
                </button>
                <button
                  @click="navigateTo('register')"
                  class="flex-1 px-6 sm:px-8 py-3 sm:py-4 bg-gray-700 text-white rounded-2xl hover:bg-gray-600 transition font-semibold shadow-lg hover:shadow-xl text-base sm:text-lg"
                >
                  –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                </button>
              </div>
            </div>
          </div>
        </template>

        <!-- Login Page -->
        <template x-if="page === 'login'">
          <div class="page-transition flex items-center justify-center py-12">
            <div class="bg-white rounded-3xl shadow-2xl p-8 sm:p-10 w-full max-w-md border border-gray-200">
              <div class="text-center mb-6 sm:mb-8">
                <div class="w-14 h-14 sm:w-16 sm:h-16 bg-gray-900 rounded-2xl flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-lg">
                  <span class="text-2xl sm:text-3xl">üîê</span>
                </div>
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!</h2>
                <p class="text-gray-600 mt-2 text-sm sm:text-base">–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç</p>
              </div>
              <div class="mb-4 sm:mb-5">
                <label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                <input
                  type="email"
                  x-model="loginForm.email"
                  placeholder="example@mail.com"
                  class="w-full px-4 sm:px-5 py-2.5 sm:py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-900 transition text-base"
                />
              </div>
              <div class="mb-5 sm:mb-6">
                <label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">–ü–∞—Ä–æ–ª—å</label>
                <input
                  type="password"
                  x-model="loginForm.password"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  @keyup.enter="login()"
                  class="w-full px-4 sm:px-5 py-2.5 sm:py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-900 transition text-base"
                />
              </div>
              <button
                @click="login()"
                class="w-full px-5 sm:px-6 py-3 sm:py-4 bg-gray-900 text-white rounded-2xl hover:bg-gray-800 transition font-semibold shadow-lg hover:shadow-xl text-base sm:text-lg"
              >
                –í–æ–π—Ç–∏
              </button>
              <div class="mt-6 sm:mt-8 text-center">
                <p class="text-gray-600 text-sm sm:text-base">
                  –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?
                  <button
                    @click="navigateTo('register')"
                    class="text-gray-900 hover:text-gray-700 font-semibold underline"
                  >
                    –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                  </button>
                </p>
              </div>
            </div>
          </div>
        </template>

        <!-- Register Page -->
        <template x-if="page === 'register'">
          <div class="page-transition flex items-center justify-center py-12">
            <div class="bg-white rounded-3xl shadow-2xl p-8 sm:p-10 w-full max-w-md border border-gray-200">
              <div class="text-center mb-6 sm:mb-8">
                <div class="w-14 h-14 sm:w-16 sm:h-16 bg-gray-700 rounded-2xl flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-lg">
                  <span class="text-2xl sm:text-3xl">‚ú®</span>
                </div>
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h2>
                <p class="text-gray-600 mt-2 text-sm sm:text-base">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞–º —Å–µ–≥–æ–¥–Ω—è</p>
              </div>
              <div class="mb-4 sm:mb-5">
                <label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">–ü–æ–ª–Ω–æ–µ –∏–º—è</label>
                <input
                  type="text"
                  x-model="registerForm.name"
                  placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"
                  class="w-full px-4 sm:px-5 py-2.5 sm:py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-700 transition text-base"
                />
              </div>
              <div class="mb-4 sm:mb-5">
                <label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                <input
                  type="email"
                  x-model="registerForm.email"
                  placeholder="example@mail.com"
                  class="w-full px-4 sm:px-5 py-2.5 sm:py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-700 transition text-base"
                />
              </div>
              <div class="mb-5 sm:mb-6">
                <label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">–ü–∞—Ä–æ–ª—å</label>
                <input
                  type="password"
                  x-model="registerForm.password"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  @keyup.enter="register()"
                  class="w-full px-4 sm:px-5 py-2.5 sm:py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-700 transition text-base"
                />
              </div>
              <button
                @click="register()"
                class="w-full px-5 sm:px-6 py-3 sm:py-4 bg-gray-700 text-white rounded-2xl hover:bg-gray-600 transition font-semibold shadow-lg hover:shadow-xl text-base sm:text-lg"
              >
                –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
              </button>
              <div class="mt-6 sm:mt-8 text-center">
                <p class="text-gray-600 text-sm sm:text-base">
                  –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?
                  <button
                    @click="navigateTo('login')"
                    class="text-gray-900 hover:text-gray-700 font-semibold underline"
                  >
                    –í–æ–π—Ç–∏
                  </button>
                </p>
              </div>
            </div>
          </div>
        </template>

        <!-- Home/Products Page -->
        <template x-if="user && page === 'home'">
          <div class="page-transition">
            <!-- Search and Filter Bar -->
            <div class="mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
              <div class="flex-1 max-w-2xl">
                <div class="relative">
                  <input
                    type="text"
                    x-model="searchQuery"
                    @input="searchProducts()"
                    placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..."
                    class="w-full px-6 py-4 pl-12 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-900 transition shadow-sm bg-white"
                  />
                  <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl">üîç</span>
                </div>
              </div>
              <template x-if="user.role === 'ADMIN'">
                <button
                  @click="navigateTo('product-form')"
                  class="px-6 py-4 bg-gray-900 text-white rounded-2xl hover:bg-gray-800 transition shadow-lg hover:shadow-xl font-semibold whitespace-nowrap"
                >
                  ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                </button>
              </template>
            </div>

            <!-- Quick Stats for logged in users -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
              <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600">–í –∫–æ—Ä–∑–∏–Ω–µ</p>
                    <p class="text-2xl font-bold text-gray-900" x-text="cart.items ? cart.items.length : 0"></p>
                  </div>
                  <div class="w-12 h-12 bg-gray-900 rounded-xl flex items-center justify-center">
                    <span class="text-2xl">üõí</span>
                  </div>
                </div>
              </div>
              <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</p>
                    <p class="text-2xl font-bold text-gray-900" x-text="orders ? orders.length : 0"></p>
                  </div>
                  <div class="w-12 h-12 bg-gray-700 rounded-xl flex items-center justify-center">
                    <span class="text-2xl">üì¶</span>
                  </div>
                </div>
              </div>
              <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</p>
                    <p class="text-2xl font-bold text-gray-900" x-text="products ? products.length : 0"></p>
                  </div>
                  <div class="w-12 h-12 bg-gray-500 rounded-xl flex items-center justify-center">
                    <span class="text-2xl">üè™</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Products Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              <template x-for="product in products" :key="product.id">
                <div class="bg-white rounded-3xl overflow-hidden border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                  <div class="h-56 bg-gray-100 flex items-center justify-center relative overflow-hidden">
                    <template x-if="product.imageUrl">
                      <img
                        :src="product.imageUrl"
                        :alt="product.name"
                        class="h-full w-full object-cover"
                      />
                    </template>
                    <template x-if="!product.imageUrl">
                      <span class="text-7xl">üì¶</span>
                    </template>
                    <div
                      :class="product.stock > 0 ? 'bg-gray-900' : 'bg-gray-400'"
                      class="absolute top-4 right-4 px-3 py-1 rounded-full text-white text-sm font-semibold shadow-lg"
                    >
                      <template x-if="product.stock > 0">
                        ‚úì –í –Ω–∞–ª–∏—á–∏–∏: <span x-text="product.stock"></span>
                      </template>
                      <template x-if="product.stock === 0">
                        –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
                      </template>
                    </div>
                  </div>
                  <div class="p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-2" x-text="product.name"></h3>
                    <p class="text-gray-600 text-sm mb-4 line-clamp-2" x-text="product.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'"></p>
                    <div class="flex justify-between items-center mb-4">
                      <span class="text-3xl font-bold text-gray-900"
                        ><span x-text="product.price"></span> ‚ÇΩ</span>
                    </div>
                    <div class="flex gap-2">
                      <button
                        @click="addToCart(product.id)"
                        :disabled="product.stock === 0"
                        :class="product.stock === 0 ? 'bg-gray-300 cursor-not-allowed' : 'bg-gray-900 hover:bg-gray-800 shadow-lg hover:shadow-xl'"
                        class="flex-1 px-5 py-3 text-white rounded-2xl transition font-semibold"
                      >
                        üõí –í –∫–æ—Ä–∑–∏–Ω—É
                      </button>
                      <template x-if="user && user.role === 'ADMIN'">
                        <button
                          @click="editProduct(product)"
                          class="px-4 py-3 bg-gray-200 text-gray-700 rounded-2xl hover:bg-gray-300 transition"
                        >
                          ‚úèÔ∏è
                        </button>
                        <button
                          @click="deleteProduct(product.id)"
                          class="px-4 py-3 bg-gray-200 text-gray-700 rounded-2xl hover:bg-gray-300 transition"
                        >
                          üóëÔ∏è
                        </button>
                      </template>
                    </div>
                  </div>
                </div>
              </template>
            </div>

            <!-- Quick Actions -->
            <div class="mt-12 flex flex-wrap justify-center gap-4">
              <button
                @click="navigateTo('orders')"
                class="px-8 py-4 bg-gray-800 text-white rounded-2xl hover:bg-gray-700 transition font-semibold shadow-lg hover:shadow-xl"
              >
                  üìã –ú–æ–∏ –∑–∞–∫–∞–∑—ã
                </button>
                <template x-if="user.role === 'ADMIN'">
                  <button
                    @click="navigateTo('admin')"
                    class="px-8 py-4 bg-gray-700 text-white rounded-2xl hover:bg-gray-600 transition font-semibold shadow-lg hover:shadow-xl"
                  >
                    ‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
                  </button>
                </template>
              </div>
            </div>
          </div>
        </template>

        <!-- Cart Page -->
        <template x-if="page === 'cart'">
          <div class="page-transition">
            <div class="mb-8">
              <button @click="navigateTo('home')" class="text-gray-900 hover:text-gray-700 font-medium mb-4 flex items-center gap-2">
                ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–∫—É–ø–∫–∞–º
              </button>
              <h2 class="text-4xl font-bold text-gray-900">–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫</h2>
              <p class="text-gray-600 mt-2">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –ø–µ—Ä–µ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞</p>
            </div>

            <template x-if="cart.items && cart.items.length > 0">
              <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 space-y-4">
                  <template x-for="item in cart.items" :key="item.id">
                    <div class="bg-white rounded-3xl p-4 sm:p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                      <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6">
                        <div class="w-20 h-20 sm:w-24 sm:h-24 bg-gray-100 rounded-2xl flex items-center justify-center flex-shrink-0">
                          <template x-if="item.product.imageUrl">
                            <img
                              :src="item.product.imageUrl"
                              :alt="item.product.name"
                              class="w-full h-full object-cover rounded-2xl"
                            />
                          </template>
                          <template x-if="!item.product.imageUrl">
                            <span class="text-3xl sm:text-4xl">üì¶</span>
                          </template>
                        </div>
                        <div class="flex-1 w-full">
                          <h3 class="text-lg sm:text-xl font-bold text-gray-900" x-text="item.product.name"></h3>
                          <p class="text-gray-900 font-semibold text-base sm:text-lg mt-1">
                            <span x-text="item.product.price"></span> ‚ÇΩ <span class="text-sm text-gray-500">–∑–∞ —à—Ç.</span>
                          </p>
                          <p class="text-sm text-gray-500 mt-1">
                            –î–æ—Å—Ç—É–ø–Ω–æ: <span x-text="item.product.stock"></span> —à—Ç.
                          </p>
                        </div>
                        <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-4 w-full sm:w-auto">
                          <div class="flex items-center justify-between sm:justify-start gap-2 bg-gray-100 rounded-2xl px-4 py-2">
                            <label class="text-sm text-gray-600 font-medium">–ö–æ–ª-–≤–æ:</label>
                            <input
                              type="numeric"
                              :value="item.quantity"
                              @change="updateCartItem(item.id, $event.target.value)"
                              min="1"
                              :max="item.product.stock"
                              class="w-16 px-2 py-1 border-2 border-gray-300 rounded-xl text-center focus:outline-none focus:border-gray-900"
                            />
                          </div>
                          <div class="flex items-center justify-between sm:justify-start gap-3">
                            <div class="text-left sm:text-right min-w-[100px]">
                              <p class="text-xl sm:text-2xl font-bold text-gray-900">
                                <span x-text="(item.product.price * item.quantity).toFixed(2)"></span> ‚ÇΩ
                              </p>
                            </div>
                            <button
                              @click="removeFromCart(item.id)"
                              class="px-4 py-3 bg-gray-200 text-gray-700 rounded-2xl hover:bg-gray-300 transition"
                            >
                              üóëÔ∏è
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </template>
                </div>

                <div class="lg:col-span-1">
                  <div class="bg-white rounded-3xl p-6 border border-gray-200 shadow-sm sticky top-24">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">–ò—Ç–æ–≥–æ</h3>
                    <div class="space-y-3 mb-6">
                      <div class="flex justify-between text-gray-600">
                        <span>–¢–æ–≤–∞—Ä–æ–≤:</span>
                        <span class="font-semibold" x-text="cart.items.length"></span>
                      </div>
                      <div class="flex justify-between text-gray-600">
                        <span>–°—É–º–º–∞:</span>
                        <span class="font-semibold"><span x-text="calculateCartTotal()"></span> ‚ÇΩ</span>
                      </div>
                      <div class="border-t-2 border-gray-200 pt-3 mt-3">
                        <div class="flex justify-between text-3xl font-bold">
                          <span class="text-gray-900">–ò—Ç–æ–≥–æ:</span>
                          <span class="text-gray-900">
                            <span x-text="calculateCartTotal()"></span> ‚ÇΩ
                          </span>
                        </div>
                      </div>
                    </div>
                    <button
                      @click="createOrder()"
                      class="w-full px-6 py-4 bg-gray-900 text-white rounded-2xl hover:bg-gray-800 transition font-semibold shadow-lg hover:shadow-xl mb-3"
                    >
                      üéâ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                    </button>
                    <button
                      @click="clearCart()"
                      class="w-full px-6 py-4 bg-gray-200 text-gray-700 rounded-2xl hover:bg-gray-300 transition font-semibold"
                    >
                      –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                  </div>
                </div>
              </div>
            </template>

            <template x-if="!cart.items || cart.items.length === 0">
              <div class="bg-white rounded-3xl p-16 text-center border border-gray-200 shadow-sm">
                <div class="text-8xl mb-6">üõí</div>
                <p class="text-gray-600 text-2xl mb-8">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
                <button
                  @click="navigateTo('home')"
                  class="px-8 py-4 bg-gray-900 text-white rounded-2xl hover:bg-gray-800 transition font-semibold shadow-lg inline-block"
                >
                  –ù–∞—á–∞—Ç—å –ø–æ–∫—É–ø–∫–∏
                </button>
              </div>
            </template>
          </div>
        </template>

        <!-- Orders Page -->
        <template x-if="page === 'orders'">
          <div class="page-transition">
            <div class="mb-6">
              <button @click="navigateTo('home')" class="text-gray-900 hover:text-gray-700 mb-4 font-medium">
                ‚Üê –ù–∞–∑–∞–¥ –∫ —Ç–æ–≤–∞—Ä–∞–º
              </button>
              <h2 class="text-3xl font-bold text-gray-900">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
              <p class="text-gray-600 mt-1">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã</p>
            </div>

            <template x-if="orders && orders.length > 0">
              <div class="space-y-4">
                <template x-for="order in orders" :key="order.id">
                  <div class="bg-white rounded-3xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition">
                    <div class="flex justify-between items-start mb-6">
                      <div>
                        <p class="text-sm text-gray-500">
                          ID –∑–∞–∫–∞–∑–∞:
                          <span class="font-mono text-gray-700" x-text="order.id.substring(0, 8)"></span>...
                        </p>
                        <p class="text-sm text-gray-500 mt-1">
                          üìÖ
                          <span
                            x-text="new Date(order.createdAt).toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })"
                          ></span>
                        </p>
                      </div>
                      <div class="text-right">
                        <span
                          :class="{
                            'bg-gray-200 text-gray-800': order.status === 'PENDING',
                            'bg-gray-700 text-white': order.status === 'PROCESSING',
                            'bg-gray-900 text-white': order.status === 'COMPLETED',
                            'bg-gray-400 text-gray-800': order.status === 'CANCELLED'
                          }"
                          class="px-3 py-1 rounded-full text-sm font-medium"
                          x-text="order.status"
                        ></span>
                        <p class="text-2xl font-bold text-gray-900 mt-2">
                          <span x-text="order.total.toFixed(2)"></span> ‚ÇΩ
                        </p>
                      </div>
                    </div>
                    <div class="border-t border-gray-200 pt-4">
                      <h4 class="font-semibold text-gray-900 mb-3">–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ:</h4>
                      <template x-for="item in order.items" :key="item.id">
                        <div class="flex justify-between py-2 text-gray-600">
                          <span
                            >üì¶ <span x-text="item.product.name"></span>
                            <span class="text-gray-400">x<span x-text="item.quantity"></span></span
                          ></span>
                          <span class="font-medium"
                            ><span x-text="(item.price * item.quantity).toFixed(2)"></span> ‚ÇΩ</span>
                        </div>
                      </template>
                    </div>
                    <template x-if="order.status !== 'COMPLETED' && order.status !== 'CANCELLED'">
                      <button
                        @click="cancelOrder(order.id)"
                        class="mt-4 px-4 py-2 bg-gray-700 text-white rounded-2xl hover:bg-gray-600 transition"
                      >
                        ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
                      </button>
                    </template>
                  </div>
                </template>
              </div>
            </template>

            <template x-if="!orders || orders.length === 0">
              <div class="bg-white rounded-3xl shadow-sm border border-gray-200 p-12 text-center">
                <div class="text-6xl mb-4">üìã</div>
                <p class="text-gray-600 text-xl mb-6">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
                <button
                  @click="navigateTo('home')"
                  class="px-6 py-3 bg-gray-900 text-white rounded-2xl hover:bg-gray-800 transition font-medium"
                >
                  –ù–∞—á–∞—Ç—å –ø–æ–∫—É–ø–∫–∏
                </button>
              </div>
            </template>
          </div>
        </template>

        <!-- Profile Page -->
        <template x-if="page === 'profile'">
          <div class="page-transition max-w-2xl mx-auto">
            <div class="mb-6">
              <button @click="navigateTo('home')" class="text-gray-900 hover:text-gray-700 mb-4 font-medium">
                ‚Üê –ù–∞–∑–∞–¥ –∫ —Ç–æ–≤–∞—Ä–∞–º
              </button>
              <h2 class="text-3xl font-bold text-gray-900">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
              <p class="text-gray-600 mt-1">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</p>
            </div>

            <div class="bg-white rounded-3xl shadow-sm border border-gray-200 p-6 mb-6">
              <h3 class="text-xl font-bold text-gray-900 mb-4">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è</h3>
              <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-2">–ü–æ–ª–Ω–æ–µ –∏–º—è</label>
                <input
                  type="text"
                  x-model="profileForm.name"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-900 transition"
                />
              </div>
              <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-2">Email</label>
                <input
                  type="email"
                  x-model="profileForm.email"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-900 transition"
                />
              </div>
              <button
                @click="updateProfile()"
                class="px-6 py-3 bg-gray-900 text-white rounded-2xl hover:bg-gray-800 transition font-medium"
              >
                üíæ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
              </button>
            </div>

            <div class="bg-white rounded-3xl shadow-sm border border-gray-200 p-6">
              <h3 class="text-xl font-bold text-gray-900 mb-4">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
              <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-2">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                <input
                  type="password"
                  x-model="passwordForm.currentPassword"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-900 transition"
                />
              </div>
              <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-2">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                <input
                  type="password"
                  x-model="passwordForm.newPassword"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-900 transition"
                />
              </div>
              <button
                @click="changePassword()"
                class="px-6 py-3 bg-gray-700 text-white rounded-2xl hover:bg-gray-600 transition font-medium"
              >
                üîí –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
              </button>
            </div>
          </div>
        </template>

        <!-- Admin Panel Page -->
        <template x-if="page === 'admin'">
          <div class="page-transition">
            <div class="mb-6">
              <button @click="navigateTo('home')" class="text-gray-900 hover:text-gray-700 mb-4 font-medium">
                ‚Üê –ù–∞–∑–∞–¥ –∫ —Ç–æ–≤–∞—Ä–∞–º
              </button>
              <h2 class="text-3xl font-bold text-gray-900">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
              <p class="text-gray-600 mt-1">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∑–∞–∫–∞–∑–∞–º–∏</p>
            </div>

            <div class="mb-6">
              <div class="flex space-x-2 border-b border-gray-200">
                <button
                  @click="adminView = 'users'"
                  :class="adminView === 'users' ? 'border-b-2 border-gray-900 text-gray-900' : 'text-gray-600'"
                  class="px-6 py-3 font-medium transition"
                >
                  üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                </button>
                <button
                  @click="adminView = 'orders'"
                  :class="adminView === 'orders' ? 'border-b-2 border-gray-900 text-gray-900' : 'text-gray-600'"
                  class="px-6 py-3 font-medium transition"
                >
                  üì¶ –í—Å–µ –∑–∞–∫–∞–∑—ã
                </button>
              </div>
            </div>

            <div x-show="adminView === 'users'">
              <div class="bg-white rounded-3xl shadow-sm border border-gray-200 overflow-hidden">
                <table class="min-w-full">
                  <thead class="bg-gray-900 text-white">
                    <tr>
                      <th class="px-6 py-4 text-left text-sm font-semibold uppercase">–ò–º—è</th>
                      <th class="px-6 py-4 text-left text-sm font-semibold uppercase">Email</th>
                      <th class="px-6 py-4 text-left text-sm font-semibold uppercase">–†–æ–ª—å</th>
                      <th class="px-6 py-4 text-left text-sm font-semibold uppercase">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</th>
                      <th class="px-6 py-4 text-left text-sm font-semibold uppercase">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-gray-200">
                    <template x-for="user in allUsers" :key="user.id">
                      <tr class="hover:bg-gray-50 transition">
                        <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900" x-text="user.name"></td>
                        <td class="px-6 py-4 whitespace-nowrap text-gray-600" x-text="user.email"></td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <span
                            :class="user.role === 'ADMIN' ? 'bg-gray-900 text-white' : 'bg-gray-200 text-gray-800'"
                            class="px-2 py-1 rounded text-sm font-medium"
                            x-text="user.role"
                          ></span>
                        </td>
                        <td
                          class="px-6 py-4 whitespace-nowrap text-gray-600"
                          x-text="new Date(user.createdAt).toLocaleDateString('ru-RU')"
                        ></td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <button
                            @click="deleteUser(user.id)"
                            class="px-4 py-2 bg-gray-700 text-white rounded-2xl hover:bg-gray-600 transition"
                          >
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                          </button>
                        </td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
            </div>

            <div x-show="adminView === 'orders'">
              <div class="space-y-4">
                <template x-for="order in allOrders" :key="order.id">
                  <div class="bg-white rounded-3xl shadow-sm border border-gray-200 p-6">
                    <div class="flex justify-between items-start mb-4">
                      <div>
                        <p class="text-sm text-gray-500">
                          ID –∑–∞–∫–∞–∑–∞:
                          <span class="font-mono text-gray-700" x-text="order.id.substring(0, 8)"></span>...
                        </p>
                        <p class="text-sm text-gray-600 mt-1">
                          üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <span class="font-medium" x-text="order.user.name"></span> (<span
                            x-text="order.user.email"
                          ></span
                          >)
                        </p>
                        <p class="text-sm text-gray-500 mt-1">
                          üìÖ
                          <span
                            x-text="new Date(order.createdAt).toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })"
                          ></span>
                        </p>
                      </div>
                      <div class="text-right">
                        <select
                          @change="updateOrderStatus(order.id, $event.target.value)"
                          :value="order.status"
                          class="px-3 py-2 border-2 border-gray-300 rounded-2xl text-sm font-medium focus:outline-none focus:border-gray-900 transition"
                        >
                          <option value="PENDING">PENDING</option>
                          <option value="PROCESSING">PROCESSING</option>
                          <option value="COMPLETED">COMPLETED</option>
                          <option value="CANCELLED">CANCELLED</option>
                        </select>
                        <p class="text-2xl font-bold text-gray-900 mt-2">
                          <span x-text="order.total.toFixed(2)"></span> ‚ÇΩ
                        </p>
                      </div>
                    </div>
                    <div class="border-t pt-4">
                      <template x-for="item in order.items" :key="item.id">
                        <div class="flex justify-between py-2 text-gray-600">
                          <span
                            >üì¶ <span x-text="item.product.name"></span>
                            <span class="text-gray-400">x<span x-text="item.quantity"></span></span
                          ></span>
                          <span class="font-medium"
                            >$<span x-text="(item.price * item.quantity).toFixed(2)"></span
                          ></span>
                        </div>
                      </template>
                    </div>
                  </div>
                </template>
              </div>
            </div>
          </div>
        </template>

        <!-- Product Form Page (Add/Edit Product) -->
        <template x-if="page === 'product-form'">
          <div class="page-transition max-w-2xl mx-auto">
            <div class="mb-6">
              <button @click="navigateTo('home')" class="text-gray-900 hover:text-gray-700 mb-4 font-medium">
                ‚Üê –ù–∞–∑–∞–¥ –∫ —Ç–æ–≤–∞—Ä–∞–º
              </button>
              <h2
                class="text-3xl font-bold text-gray-900"
                x-text="editingProduct ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä' : '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä'"
              ></h2>
              <p class="text-gray-600 mt-1">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ</p>
            </div>

            <div class="bg-white rounded-3xl shadow-sm border border-gray-200 p-6">
              <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
                <input
                  type="text"
                  x-model="productForm.name"
                  placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-900 transition"
                />
              </div>
              <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea
                  x-model="productForm.description"
                  placeholder="–û–ø–∏—à–∏—Ç–µ —Ç–æ–≤–∞—Ä..."
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-900 transition"
                  rows="4"
                ></textarea>
              </div>
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-gray-700 font-medium mb-2">–¶–µ–Ω–∞ (‚ÇΩ)</label>
                  <input
                    type="numeric"
                    x-model.number="productForm.price"
                    step="0.01"
                    min="0"
                    placeholder="0.00"
                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-900 transition"
                  />
                </div>
                <div>
                  <label class="block text-gray-700 font-medium mb-2">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ</label>
                  <input
                    type="numeric"
                    x-model.number="productForm.stock"
                    min="0"
                    placeholder="0"
                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-900 transition"
                  />
                </div>
              </div>
              <div class="mb-6">
                <label class="block text-gray-700 font-medium mb-2">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <input
                  type="text"
                  x-model="productForm.imageUrl"
                  placeholder="https://example.com/image.jpg"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-2xl focus:outline-none focus:border-gray-900 transition"
                />
              </div>
              <div class="flex space-x-3">
                <button
                  @click="saveProduct()"
                  class="flex-1 px-6 py-3 bg-gray-900 text-white rounded-2xl hover:bg-gray-800 transition font-medium"
                >
                  üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä
                </button>
                <button
                  @click="navigateTo('home'); editingProduct = null"
                  class="px-6 py-3 bg-gray-300 text-gray-700 rounded-2xl hover:bg-gray-400 transition font-medium"
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        </template>

        </div>
        <!-- End of content wrapper -->
      </div>
      <!-- End of main content -->
    </div>
    <!-- End of Alpine.js app -->

    <script>
      function app() {
        return {
          API_URL: "/api",
          token: localStorage.getItem("token") || null,
          user: null,
          page: "home",
          adminView: "users",
          editingProduct: null,
          searchQuery: "",
          products: [],
          cart: { items: [] },
          orders: [],
          allUsers: [],
          allOrders: [],
          alert: { show: false, message: "", type: "success" },
          loginForm: { email: "", password: "" },
          registerForm: { name: "", email: "", password: "" },
          profileForm: { name: "", email: "" },
          passwordForm: { currentPassword: "", newPassword: "" },
          productForm: {
            name: "",
            description: "",
            price: 0,
            stock: 0,
            imageUrl: "",
          },

          init() {
            if (this.token) {
              this.loadProfile();
            } else {
              this.page = "home";
            }
            this.loadProducts();
          },

          navigateTo(page) {
            this.page = page;
            window.scrollTo(0, 0);

            if (page === "home") {
              this.loadProducts();
            } else if (page === "cart" && this.user) {
              this.loadCart();
            } else if (page === "orders" && this.user) {
              this.loadOrders();
            } else if (page === "admin" && this.user && this.user.role === "ADMIN") {
              this.loadAllUsers();
              this.loadAllOrders();
            } else if (page === "profile" && this.user) {
              this.profileForm = { name: this.user.name, email: this.user.email };
            }
          },

          async apiCall(endpoint, method = "GET", body = null) {
            const options = {
              method,
              headers: {
                "Content-Type": "application/json",
              },
            };

            if (this.token) {
              options.headers["Authorization"] = `Bearer ${this.token}`;
            }

            if (body) {
              options.body = JSON.stringify(body);
            }

            try {
              const response = await fetch(`${this.API_URL}${endpoint}`, options);
              const data = await response.json();

              if (!response.ok) {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
                if (data.error === "Validation error" && data.details) {
                  const errorMessages = data.details.map(err => {
                    const field = err.path.join('.');
                    const fieldNames = {
                      'price': '–¶–µ–Ω–∞',
                      'stock': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
                      'name': '–ù–∞–∑–≤–∞–Ω–∏–µ',
                      'email': 'Email',
                      'password': '–ü–∞—Ä–æ–ª—å',
                      'quantity': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
                      'description': '–û–ø–∏—Å–∞–Ω–∏–µ'
                    };
                    const readableField = fieldNames[field] || field;
                    
                    if (err.code === 'invalid_type') {
                      return `${readableField}: –æ–∂–∏–¥–∞–µ—Ç—Å—è ${err.expected === 'number' ? '—á–∏—Å–ª–æ' : err.expected}`;
                    }
                    return `${readableField}: ${err.message || '–Ω–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ'}`;
                  });
                  throw new Error(errorMessages.join('; '));
                }
                
                throw new Error(data.error || "–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫");
              }

              return data;
            } catch (error) {
              this.showAlert(error.message, "error");
              throw error;
            }
          },

          showAlert(message, type = "success") {
            this.alert = { show: true, message, type };
            setTimeout(() => {
              this.alert.show = false;
            }, 5000);
          },

          async login() {
            try {
              // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
              if (!this.loginForm.email || !this.loginForm.email.includes('@')) {
                this.showAlert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email", "error");
                return;
              }
              if (!this.loginForm.password) {
                this.showAlert("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å", "error");
                return;
              }

              const data = await this.apiCall("/auth/login", "POST", this.loginForm);
              this.token = data.token;
              this.user = data.user;
              localStorage.setItem("token", this.token);
              this.loginForm = { email: "", password: "" };
              this.showAlert("–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!", "success");
              this.navigateTo("home");
              this.loadCart();
              this.loadOrders();
            } catch (error) {
              console.error(error);
            }
          },

          async register() {
            try {
              // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
              if (!this.registerForm.name || this.registerForm.name.trim() === '') {
                this.showAlert("–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ", "error");
                return;
              }
              if (!this.registerForm.email || !this.registerForm.email.includes('@')) {
                this.showAlert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email", "error");
                return;
              }
              if (!this.registerForm.password || this.registerForm.password.length < 6) {
                this.showAlert("–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤", "error");
                return;
              }

              const data = await this.apiCall("/auth/register", "POST", this.registerForm);
              this.token = data.token;
              this.user = data.user;
              localStorage.setItem("token", this.token);
              this.registerForm = { name: "", email: "", password: "" };
              this.showAlert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!", "success");
              this.navigateTo("home");
              this.loadCart();
            } catch (error) {
              console.error(error);
            }
          },

          async loadProfile() {
            try {
              this.user = await this.apiCall("/auth/profile");
              this.profileForm = { name: this.user.name, email: this.user.email };
              this.loadCart();
              this.loadOrders();
              if (this.user.role === "ADMIN") {
                this.loadAllUsers();
                this.loadAllOrders();
              }
            } catch (error) {
              this.logout();
            }
          },

          async updateProfile() {
            try {
              this.user = await this.apiCall("/users/profile", "PUT", this.profileForm);
              this.showAlert("–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!");
            } catch (error) {
              console.error(error);
            }
          },

          async changePassword() {
            try {
              await this.apiCall("/users/change-password", "POST", this.passwordForm);
              this.passwordForm = { currentPassword: "", newPassword: "" };
              this.showAlert("–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!");
            } catch (error) {
              console.error(error);
            }
          },

          logout() {
            this.token = null;
            this.user = null;
            this.cart = { items: [] };
            this.orders = [];
            localStorage.removeItem("token");
            this.navigateTo("home");
            this.showAlert("–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã!");
          },

          async loadProducts() {
            try {
              this.products = await this.apiCall("/products");
            } catch (error) {
              console.error(error);
            }
          },

          async searchProducts() {
            try {
              if (this.searchQuery.trim()) {
                this.products = await this.apiCall(
                  `/products/search?q=${encodeURIComponent(this.searchQuery)}`
                );
              } else {
                this.loadProducts();
              }
            } catch (error) {
              console.error(error);
            }
          },

          editProduct(product) {
            this.editingProduct = product;
            this.productForm = {
              name: product.name,
              description: product.description || "",
              price: product.price,
              stock: product.stock,
              imageUrl: product.imageUrl || "",
            };
            this.navigateTo("product-form");
          },

          async saveProduct() {
            try {
              // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
              const productData = {
                name: this.productForm.name,
                description: this.productForm.description || "",
                price: parseFloat(this.productForm.price),
                stock: parseInt(this.productForm.stock),
                imageUrl: this.productForm.imageUrl || "",
              };

              // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
              if (!productData.name || productData.name.trim() === '') {
                this.showAlert("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ", "error");
                return;
              }
              if (isNaN(productData.price) || productData.price <= 0) {
                this.showAlert("–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º", "error");
                return;
              }
              if (isNaN(productData.stock) || productData.stock < 0) {
                this.showAlert("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º", "error");
                return;
              }

              if (this.editingProduct) {
                await this.apiCall(`/products/${this.editingProduct.id}`, "PUT", productData);
                this.showAlert("–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!");
              } else {
                await this.apiCall("/products", "POST", productData);
                this.showAlert("–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!");
              }
              this.editingProduct = null;
              this.productForm = {
                name: "",
                description: "",
                price: 0,
                stock: 0,
                imageUrl: "",
              };
              this.navigateTo("home");
              this.loadProducts();
            } catch (error) {
              console.error(error);
            }
          },

          async deleteProduct(id) {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?")) {
              try {
                await this.apiCall(`/products/${id}`, "DELETE");
                this.showAlert("–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!");
                this.loadProducts();
              } catch (error) {
                console.error(error);
              }
            }
          },

          async loadCart() {
            try {
              this.cart = await this.apiCall("/cart");
            } catch (error) {
              console.error(error);
            }
          },

          async addToCart(productId) {
            try {
              await this.apiCall("/cart/items", "POST", { productId, quantity: 1 });
              this.showAlert("–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!");
              this.loadCart();
            } catch (error) {
              console.error(error);
            }
          },

          async updateCartItem(itemId, quantity) {
            try {
              await this.apiCall(`/cart/items/${itemId}`, "PUT", {
                quantity: parseInt(quantity),
              });
              this.loadCart();
            } catch (error) {
              console.error(error);
            }
          },

          async removeFromCart(itemId) {
            try {
              await this.apiCall(`/cart/items/${itemId}`, "DELETE");
              this.showAlert("–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã!");
              this.loadCart();
            } catch (error) {
              console.error(error);
            }
          },

          async clearCart() {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?")) {
              try {
                await this.apiCall("/cart", "DELETE");
                this.showAlert("–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞!");
                this.loadCart();
              } catch (error) {
                console.error(error);
              }
            }
          },

          calculateCartTotal() {
            return this.cart.items
              .reduce((total, item) => {
                return total + item.product.price * item.quantity;
              }, 0)
              .toFixed(2);
          },

          async createOrder() {
            if (confirm("–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?")) {
              try {
                await this.apiCall("/orders", "POST");
                this.showAlert("–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! üéâ");
                this.loadCart();
                this.loadOrders();
                this.navigateTo("orders");
              } catch (error) {
                console.error(error);
              }
            }
          },

          async loadOrders() {
            try {
              this.orders = await this.apiCall("/orders");
            } catch (error) {
              console.error(error);
            }
          },

          async cancelOrder(orderId) {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑?")) {
              try {
                await this.apiCall(`/orders/${orderId}/cancel`, "POST");
                this.showAlert("–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–º–µ–Ω–µ–Ω!");
                this.loadOrders();
              } catch (error) {
                console.error(error);
              }
            }
          },

          async loadAllUsers() {
            try {
              this.allUsers = await this.apiCall("/users");
            } catch (error) {
              console.error(error);
            }
          },

          async deleteUser(userId) {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?")) {
              try {
                await this.apiCall(`/users/${userId}`, "DELETE");
                this.showAlert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!");
                this.loadAllUsers();
              } catch (error) {
                console.error(error);
              }
            }
          },

          async loadAllOrders() {
            try {
              this.allOrders = await this.apiCall("/orders/admin/all");
            } catch (error) {
              console.error(error);
            }
          },

          async updateOrderStatus(orderId, status) {
            try {
              await this.apiCall(`/orders/${orderId}/status`, "PUT", { status });
              this.showAlert("–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω!");
              this.loadAllOrders();
            } catch (error) {
              console.error(error);
            }
          },
        };
      }
    </script>
  </body>
</html>
